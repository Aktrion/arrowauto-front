<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Vehicle Inspection</h1>
      <p class="text-base-content/60 mt-1">Perform and manage vehicle inspections with precision</p>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Vehicle Selection -->
    <div class="lg:col-span-1 space-y-6">
      <div class="card card-premium">
        <div class="card-body p-5">
          <h2 class="card-title text-lg flex justify-between items-center mb-2">
            Select Vehicle
            <span class="badge badge-neutral font-normal">{{ vehiclesForInspection().length }} pending</span>
          </h2>

          <div class="space-y-3 mt-2 h-[calc(100vh-25rem)] overflow-y-auto pr-1 custom-scrollbar">
            @for (vehicle of vehiclesForInspection(); track vehicle.id) {
            <button
              class="w-full p-4 rounded-xl border transition-all text-left relative overflow-hidden group"
              [class.border-primary]="selectedVehicleId() === vehicle.id"
              [class.border-transparent]="selectedVehicleId() !== vehicle.id"
              [class.bg-primary]="selectedVehicleId() === vehicle.id"
              [class.bg-base-200]="selectedVehicleId() !== vehicle.id"
              [class.text-primary-content]="selectedVehicleId() === vehicle.id"
              [class.hover:bg-base-300]="selectedVehicleId() !== vehicle.id"
              (click)="selectVehicle(vehicle.id)"
            >
              <div class="flex items-center gap-4">
                <div class="avatar placeholder">
                  <div
                    class="rounded-lg w-12 h-12 text-lg font-bold shadow-sm"
                    [class.bg-primary-content]="selectedVehicleId() === vehicle.id"
                    [class.text-primary]="selectedVehicleId() === vehicle.id"
                    [class.bg-base-100]="selectedVehicleId() !== vehicle.id"
                    [class.text-base-content]="selectedVehicleId() !== vehicle.id"
                  >
                    <span>{{ vehicle.make.charAt(0) }}</span>
                  </div>
                </div>
                <div class="flex-1 min-w-0 z-10">
                  <p class="font-bold text-lg truncate">{{ vehicle.plate }}</p>
                  <p class="text-sm opacity-80 truncate">{{ vehicle.make }} {{ vehicle.model }}</p>
                </div>
                @if (selectedVehicleId() === vehicle.id) {
                  <div class="absolute right-3 top-1/2 -translate-y-1/2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                  </div>
                }
              </div>
            </button>
            } @empty {
            <div class="text-center py-12 text-base-content/60 bg-base-200/50 rounded-xl border border-dashed border-base-300">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
              <p>No vehicles pending inspection</p>
            </div>
            }
          </div>
        </div>
      </div>

      <!-- Inspection Summary -->
      @if (selectedVehicleId()) {
      <div class="card card-premium animate-fade-in-up">
        <div class="card-body p-5">
          <h2 class="card-title text-lg mb-4">Inspection Summary</h2>
          <div class="grid grid-cols-3 gap-2 text-center mb-6">
            <div class="p-3 bg-success/10 rounded-xl border border-success/20">
              <div class="text-success font-bold text-2xl">{{ countByStatus('ok') }}</div>
              <div class="text-xs text-success font-medium uppercase tracking-wider">OK</div>
            </div>
            <div class="p-3 bg-warning/10 rounded-xl border border-warning/20">
              <div class="text-warning font-bold text-2xl">{{ countByStatus('warning') }}</div>
              <div class="text-xs text-warning font-medium uppercase tracking-wider">Warn</div>
            </div>
            <div class="p-3 bg-error/10 rounded-xl border border-error/20">
              <div class="text-error font-bold text-2xl">{{ countByStatus('defect') }}</div>
              <div class="text-xs text-error font-medium uppercase tracking-wider">Defect</div>
            </div>
          </div>

          <div class="flex justify-between items-center px-2 mb-2">
             <span class="text-base-content/60 text-sm">Progress</span>
             <span class="font-bold text-sm">{{ countByStatus('ok') + countByStatus('warning') + countByStatus('defect') }} / {{ inspectionPoints().length }}</span>
          </div>
          <progress class="progress progress-primary w-full h-2 rounded-full mb-6" [value]="countByStatus('ok') + countByStatus('warning') + countByStatus('defect')" [max]="inspectionPoints().length"></progress>

          @if (totalCost() > 0) {
          <div class="bg-base-200/50 rounded-xl p-4 mb-4 text-center border border-base-200">
            <p class="text-xs text-base-content/60 uppercase tracking-wide font-medium">Estimated Repair Cost</p>
            <p class="text-3xl font-black text-primary mt-1">£{{ totalCost().toFixed(2) }}</p>
          </div>
          }

          <button class="btn btn-primary btn-block shadow-lg shadow-primary/20" [disabled]="!hasInspectionResults()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              />
            </svg>
            Send to Customer
          </button>
        </div>
      </div>
      }
    </div>

    <!-- Inspection Points -->
    <div class="lg:col-span-2">
      @if (selectedVehicleId()) {
      <div class="card card-premium animate-fade-in">
        <div class="card-body p-0 sm:p-5">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 p-4 sm:p-0">
            <h2 class="card-title text-xl">Inspection Points</h2>
            <div class="tabs tabs-boxed bg-base-200/50 p-1 rounded-xl">
              <button
                class="tab rounded-lg transition-all duration-300"
                [class.tab-active]="activeCategory() === 'all'"
                [class.bg-white]="activeCategory() === 'all'"
                [class.shadow-sm]="activeCategory() === 'all'"
                (click)="setCategory('all')"
              >
                All
              </button>
              @for (cat of categories(); track cat) {
              <button
                class="tab rounded-lg transition-all duration-300"
                [class.tab-active]="activeCategory() === cat"
                [class.bg-white]="activeCategory() === cat"
                [class.shadow-sm]="activeCategory() === cat"
                (click)="setCategory(cat)"
              >
                {{ cat }}
              </button>
              }
            </div>
          </div>

          <div class="space-y-3 p-4 sm:p-0">
            @for (point of filteredPoints(); track point.id) {
            <div class="collapse collapse-arrow bg-base-100 border border-base-200 rounded-xl hover:border-primary/30 transition-colors shadow-sm">
              <input type="checkbox" />
              <div class="collapse-title flex items-center gap-4 py-4">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center transition-colors duration-300 shadow-inner"
                  [class.bg-success/10]="getPointStatus(point.id) === 'ok'"
                  [class.bg-warning/10]="getPointStatus(point.id) === 'warning'"
                  [class.bg-error/10]="getPointStatus(point.id) === 'defect'"
                  [class.bg-base-200]="getPointStatus(point.id) === 'not_inspected'"
                >
                  @switch (getPointStatus(point.id)) { @case ('ok') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-success"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 13l4 4L19 7"
                    />
                  </svg>
                  } @case ('warning') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-warning"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01"
                    />
                  </svg>
                  } @case ('defect') {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-error"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                  } @default {
                  <div class="w-3 h-3 rounded-full bg-base-content/20"></div>
                  } }
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <p class="font-bold text-base">{{ point.name }}</p>
                    @if(getPointStatus(point.id) !== 'not_inspected') {
                      <span class="badge badge-sm" 
                        [class.badge-success]="getPointStatus(point.id) === 'ok'"
                        [class.badge-warning]="getPointStatus(point.id) === 'warning'"
                        [class.badge-error]="getPointStatus(point.id) === 'defect'">
                        {{ getPointStatus(point.id) }}
                      </span>
                    }
                  </div>
                  <p class="text-xs text-base-content/60 font-medium uppercase tracking-wide mt-0.5">{{ point.category }}</p>
                </div>
              </div>
              <div class="collapse-content">
                <div class="space-y-5 pt-2 pb-2">
                  <div class="divider my-0"></div>
                  <!-- Status Buttons -->
                  <div class="grid grid-cols-3 gap-3">
                    <button
                      class="btn btn-sm h-10 border-success/30 hover:bg-success hover:text-success-content hover:border-success"
                      [class.btn-success]="getPointStatus(point.id) === 'ok'"
                      [class.btn-outline]="getPointStatus(point.id) !== 'ok'"
                      [class.text-success]="getPointStatus(point.id) !== 'ok'"
                      (click)="setPointStatus(point.id, 'ok')"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                      Pass
                    </button>
                    <button
                      class="btn btn-sm h-10 border-warning/30 hover:bg-warning hover:text-warning-content hover:border-warning"
                      [class.btn-warning]="getPointStatus(point.id) === 'warning'"
                      [class.btn-outline]="getPointStatus(point.id) !== 'warning'"
                      [class.text-warning]="getPointStatus(point.id) !== 'warning'"
                      (click)="setPointStatus(point.id, 'warning')"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01" /></svg>
                      Advisory
                    </button>
                    <button
                      class="btn btn-sm h-10 border-error/30 hover:bg-error hover:text-error-content hover:border-error"
                      [class.btn-error]="getPointStatus(point.id) === 'defect'"
                      [class.btn-outline]="getPointStatus(point.id) !== 'defect'"
                      [class.text-error]="getPointStatus(point.id) !== 'defect'"
                      (click)="setPointStatus(point.id, 'defect')"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                      Fail
                    </button>
                  </div>

                  <!-- Predefined Comments -->
                  @if (getPointStatus(point.id) === 'warning' || getPointStatus(point.id) === 'defect') {
                  <div class="animate-fade-in bg-base-200/30 p-4 rounded-xl border border-base-200">
                    <div class="form-control mb-4">
                      <label class="label pt-0">
                        <span class="label-text font-medium text-xs uppercase tracking-wide opacity-70">Quick Comment</span>
                      </label>
                      <div class="flex flex-wrap gap-2">
                        @for (comment of point.predefinedComments; track comment) {
                        <button
                          class="btn btn-xs rounded-full normal-case font-normal"
                          [class.btn-neutral]="getPointComment(point.id) === comment"
                          [class.btn-outline]="getPointComment(point.id) !== comment"
                          (click)="setPointComment(point.id, comment)"
                        >
                          {{ comment }}
                        </button>
                        }
                      </div>
                    </div>

                    <!-- Custom Comment -->
                    <div class="form-control mb-4">
                      <label class="label">
                        <span class="label-text font-medium text-xs uppercase tracking-wide opacity-70">Additional Notes</span>
                      </label>
                      <textarea
                        class="textarea textarea-bordered h-20 focus:border-primary focus:ring-1 focus:ring-primary/20"
                        placeholder="Add specific details about the issue..."
                        [value]="getPointNotes(point.id)"
                        (input)="setPointNotes(point.id, $event)"
                      ></textarea>
                    </div>

                    <!-- Cost Estimation -->
                    <div class="grid grid-cols-2 gap-4">
                      <div class="form-control">
                        <label class="label">
                          <span class="label-text font-medium text-xs uppercase tracking-wide opacity-70">Parts Cost (£)</span>
                        </label>
                        <div class="relative">
                          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-base-content/50">£</span>
                          <input
                            type="number"
                            class="input input-bordered input-sm w-full pl-7 focus:border-primary focus:ring-1 focus:ring-primary/20"
                            placeholder="0.00"
                            [value]="getPointPartsCost(point.id)"
                            (input)="setPointPartsCost(point.id, $event)"
                          />
                        </div>
                      </div>
                      <div class="form-control">
                        <label class="label">
                          <span class="label-text font-medium text-xs uppercase tracking-wide opacity-70">Labor Cost (£)</span>
                        </label>
                        <div class="relative">
                          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-base-content/50">£</span>
                          <input
                            type="number"
                            class="input input-bordered input-sm w-full pl-7 focus:border-primary focus:ring-1 focus:ring-primary/20"
                            placeholder="0.00"
                            [value]="getPointLaborCost(point.id)"
                            (input)="setPointLaborCost(point.id, $event)"
                          />
                        </div>
                      </div>
                    </div>

                    <!-- Photo Upload -->
                    <div class="form-control mt-4">
                      <label class="label">
                        <span class="label-text font-medium text-xs uppercase tracking-wide opacity-70">Evidence</span>
                      </label>
                      <div class="flex gap-2">
                        <button class="btn btn-outline btn-sm gap-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                          Camera
                        </button>
                        <button class="btn btn-outline btn-sm gap-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                          Upload
                        </button>
                      </div>
                    </div>
                  </div>
                  }
                </div>
              </div>
            </div>
            }
          </div>
        </div>
      </div>
      } @else {
      <div class="card card-premium">
        <div class="card-body items-center text-center py-24">
          <div class="w-24 h-24 rounded-full bg-base-200 flex items-center justify-center mb-6">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-10 w-10 text-base-content/30"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <h3 class="font-bold text-2xl">Ready to Inspect</h3>
          <p class="text-base-content/60 max-w-sm mt-2">
            Select a vehicle from the list on the left to begin the inspection process or continue a pending one.
          </p>
        </div>
      </div>
      }
    </div>
  </div>
</div>
